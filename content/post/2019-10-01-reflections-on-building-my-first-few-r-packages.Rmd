---
title: Reflections on building my first few R packages
author: ''
date: '2019-10-01'
slug: reflections-on-building-my-first-few-r-packages
categories:
  - R
tags:
  - R
  - package
summary: "HEDfunctions, FunnelPlotR and NHSRdatasets reflections"
image:
  caption: ''
  focal_point: ''
output:
  blogdown::html_page:
    toc: true
    number_sections: true
    toc_depth: 1
draft: true
---

# Package development

I've spent much of the last six months building several `R` packages.  It's the first time that I'd built packages, and I hope the released versions are much better now that they were at initial release!  This post is not a tutorial on how to build packages, but will summarise some parts I've had to learn, and aims to whos you that pakcages building is not magic.  It's particuarlrly accessible now with RStudio, `devtools`, `usethis` and `git` in combination.

## Packages

I've build or collaborated on three packages recently:

+ `FunnelPlotR`: `ggplot2` methods for producting funnel plots of indirectly standardised ratios with overdispersion adjustment
+ `NHSRdatasets`: a free, collaborative datasets package with examples of health related data, to provide in-context examples for NHS-R community and others learning `in health`R`.
+ `HEDfunctions`: an HED internal package that contains methods for some of the models build in HED production, and several utility functions like confidence intervals etc.

I first went about this by watching a couple of YouTube videos on package building.  These videos used the RStudio wizards to set up the package as an RStudo Project, as well as `roxygen2` to generate documentation. The principe, for the unitnitiated, is:

+ Packages are groups of functions, their help files and metadata
+ There are conserved package structures, but broadly, your functions go in an `R` folder, and help files in `man`
+ You have a DESRIPTION file, with the fields you see on CRAN, and a NAMESPACE (written by `roxygen2` in this case)
+ `roxygen2` converts tagged metadata into the right form for packages, on lines comments `#'` an tagged `@` e.g.:

```{r roxygen, eval=FALSE}
#' @title My function for doing a thing
#' @description This is a a function for demosntrating a very basic roxygen skeleton.
#' @param input_data A data.frame input to my function
#' @param method The method that the function uses, either "A" or "B", default is: "A"
#' 
#' @return A list containing somethings
#' @export
#' @details
#'    The function tries to do a thing, but it's ademo so it won't.
#'    Don't try and use this in the real world.
#'    Seriously  
#'
#' @import ggplot
#' @importFrom dplyr filter %>% 
#'
#' @examples
      my_function(LOS_model, method = "B")

my_function(input_data, method = "A"){

...

}

```

When you 'roxygenise' the function above, `roxygen2` will add the required packages to description and namespace, build the helpfiles into the `man` folder,  This will save you all sorts of time and headaches!  Although you will need to google the tags a lot.  I found that the formatting is not the same as Rmarkdown, it's more like Latex.  Remeber to escape characters like `%` with `\%`, as that kept messing up for me.

## Git and GitHub

Git is a source control solution, that essentially logs all your changes within a particular folder.  Once you have git installed, it intergrates with RStudio very well.  You need to add files to it, the 'commit' changes periodically to log them.  YOu can roll back your changes or merge them, as well as making 'branches', which are isolated parallel copies of the code that allow you to develop things without committing them to the 'master' branch.

Where GitHub becomes in, is for collaboration and code sharing.  GitHub is an online hosting platform for Git.  You set up repositories, 'remotes' on GitHub, and 'push' your changes from your local machine to GitHub.  GitHub allows various people to pull copies of your work and work on it, merging changes in, allowing review and collaborative development.  There are a bunch of Git and GitHun related features that help the development of packages.

## Vignettes

Vignette are the term used for 'worked examples.' They range from a few lines to show you how to use a function, to long tutorials on package use.  Some cotian several vignettes, demosntrating special cases or variants of use. I think they are helpful for demonstrating the motivation and application of a package, and I believe all packages released on CRAN should include at least one.

You can use `rmarkdown` to create vignettes.  In doing so, you need to include a few things:

1. Specificy YAML to tell the package build what it is and how to process it
1. Add `rmarkdown` and `knitr` to the Description, in `Suggests` (and the namespace).
1. Consider where image for plots are being store

The easiest way to solve all three is to call `usethis::use_vignette()`.  This sets up the YAML, picture location and the requiredd packages.  I didn't relaise this at first, and had copied the YAML in.  If you don't specify the right picture location, you can get warnings a build time about unexpected files because they are int he wrong location.  The other issue with this is that, if you use 'pkgdown' to build a package documentatino website, it won't pick up the pictures properly (see next section).

## README file

Include a README.md file in the top level of your package

## Unit testing and Code coverage

## Checking you `R` package

## Process for release

## Licencing